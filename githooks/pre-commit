#!/usr/bin/env bash
set -euo pipefail

## C/CPP FILES

if ! command -v clang-format >/dev/null 2>&1; then
  echo "pre-commit: clang-format not found in PATH" >&2
  exit 1
fi

mapfile -d '' files < <(
  git diff --cached --name-only --diff-filter=ACMR -z -- \
    '*.c' '*.cc' '*.cpp' '*.cxx' '*.h' '*.hh' '*.hpp' '*.hxx'
)

for f in "${files[@]}"; do
  clang-format -i "$f"
  git add "$f"
done

## PYTHON FILES

if ! command -v ruff >/dev/null 2>&1; then
  echo "pre-commit: ruff not found in PATH" >&2
  exit 1
fi

mapfile -d '' files < <(
  git diff --cached --name-only --diff-filter=ACMR -z -- \
    '*.py' '*.pyi'
)

for f in "${files[@]}"; do
  ruff format "$f"
  git add "$f"
done

